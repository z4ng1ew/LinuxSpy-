#!/usr/bin/env bash





# üìö –°–û–î–ï–†–ñ–ê–ù–ò–ï

1. **–§–∞–π–ª `main.sh**` ‚Äî üß† **–ú–æ–∑–≥ –∏ –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä**. –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥—Ä—É–≥–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏.
2. **–§–∞–π–ª `utils.sh**` ‚Äî üõ°Ô∏è **–û—Ö—Ä–∞–Ω–Ω–∏–∫ (–§–µ–π—Å–∫–æ–Ω—Ç—Ä–æ–ª—å)**. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–¥ —Ä–∞–±–æ—Ç–æ–π.
3. **–§–∞–π–ª `collector.sh**` ‚Äî üïµÔ∏è **–°—ã—â–∏–∫ (–°–±–æ—Ä—â–∏–∫)**. –°–∞–º–∞—è —Å–ª–æ–∂–Ω–∞—è —á–∞—Å—Ç—å: –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞, —Å–µ—Ç—å, –¥–∏—Å–∫–∏ –∏ –ø–∞–º—è—Ç—å.
4. **–§–∞–π–ª `io.sh**` ‚Äî üó£Ô∏è **–°–µ–∫—Ä–µ—Ç–∞—Ä—å (–û–±—â–µ–Ω–∏–µ)**. –î–∏–∞–ª–æ–≥ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤.









# === –ë–õ–û–ö 1: –ù–ê–°–¢–†–û–ô–ö–ê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò ("–ü–û–î–£–®–ö–ò –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò") ===
set -euo pipefail
# üõ† –†–ê–ó–ë–û–† –ö–û–ú–ê–ù–î–´ set:
# –≠—Ç–æ —Ä–µ–∂–∏–º "—Å—Ç—Ä–æ–≥–æ–≥–æ —Ä–µ–∂–∏–º–∞" –¥–ª—è Bash. –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–π–¥–µ—Ç –Ω–µ —Ç–∞–∫, —Å–∫—Ä–∏–ø—Ç —É–º—Ä–µ—Ç —Å—Ä–∞–∑—É, –∞ –Ω–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –ª–æ–º–∞—è –≤—Å—ë –≤–æ–∫—Ä—É–≥.
# -e (Exit on error): –ï—Å–ª–∏ –ª—é–±–∞—è –∫–æ–º–∞–Ω–¥–∞ –≤–µ—Ä–Ω–µ—Ç –æ—à–∏–±–∫—É (–∫–æ–¥ –Ω–µ 0), —Å–∫—Ä–∏–ø—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è.
# -u (Unset variable): –ï—Å–ª–∏ —Ç—ã –ø–æ–ø—ã—Ç–∞–µ—à—å—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é, –∫–æ—Ç–æ—Ä—É—é –∑–∞–±—ã–ª —Å–æ–∑–¥–∞—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, $nmae –≤–º–µ—Å—Ç–æ $name), —Å–∫—Ä–∏–ø—Ç –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è. –ó–∞—â–∏—Ç–∞ –æ—Ç –æ–ø–µ—á–∞—Ç–æ–∫.
# -o pipefail: –ï—Å–ª–∏ –≤ —Ü–µ–ø–æ—á–∫–µ –∫–æ–º–∞–Ω–¥ (cmd1 | cmd2 | cmd3) —Å–ª–æ–º–∞–µ—Ç—Å—è cmd1, —Ç–æ –≤—Å—è —Ü–µ–ø–æ—á–∫–∞ –±—É–¥–µ—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è –æ—à–∏–±–æ—á–Ω–æ–π. –ë–µ–∑ —ç—Ç–æ–≥–æ Bash —Å–º–æ—Ç—Ä–∏—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ —É—Å–ø–µ—Ö –ø–æ—Å–ª–µ–¥–Ω–µ–π –∫–æ–º–∞–Ω–¥—ã.


# === –ë–õ–û–ö 2: –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ì–ï–û–õ–û–ö–ê–¶–ò–ò –°–ö–†–ò–ü–¢–ê ===
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
# üîç –ß–¢–û –ó–î–ï–°–¨ –ü–†–û–ò–°–•–û–î–ò–¢:
# –ù–∞–º –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å, –≥–¥–µ –ª–µ–∂–∏—Ç —ç—Ç–æ—Ç —Ñ–∞–π–ª, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –µ–≥–æ "–¥—Ä—É–∑–µ–π" (utils.sh, collector.sh).
# ${BASH_SOURCE[0]} ‚Äî —ç—Ç–æ –ø—É—Ç—å –∫ —Ç–µ–∫—É—â–µ–º—É —Ñ–∞–π–ª—É (main.sh).
# dirname ‚Äî –æ—Ç—Ä–µ–∑–∞–µ—Ç –∏–º—è —Ñ–∞–π–ª–∞, –æ—Å—Ç–∞–≤–ª—è—è —Ç–æ–ª—å–∫–æ –ø–∞–ø–∫—É.
# cd ... && pwd ‚Äî –º—ã –≤—Ä–µ–º–µ–Ω–Ω–æ "–∑–∞—Ö–æ–¥–∏–º" –≤ —ç—Ç—É –ø–∞–ø–∫—É –∏ —Å–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ–ª–Ω—ã–π –ø—É—Ç—å (pwd).
# –í –ò–¢–û–ì–ï: –í –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π SCRIPT_DIR –ª–µ–∂–∏—Ç –ø–æ–ª–Ω—ã–π, –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ —Å —Ç–≤–æ–∏–º –ø—Ä–æ–µ–∫—Ç–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, /home/user/project).


# === –ë–õ–û–ö 3: –ò–ú–ü–û–†–¢ –ú–û–î–£–õ–ï–ô (–°–ë–û–†–ö–ê –ö–û–ú–ê–ù–î–´) ===
source "$SCRIPT_DIR/utils.sh"
source "$SCRIPT_DIR/collector.sh"
source "$SCRIPT_DIR/io.sh"
# üîå –ö–û–ú–ê–ù–î–ê source:
# –û–Ω–∞ –±—É–∫–≤–∞–ª—å–Ω–æ –±–µ—Ä–µ—Ç —Ç–µ–∫—Å—Ç –∏–∑ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏ "–≤—Å—Ç–∞–≤–ª—è–µ—Ç" –µ–≥–æ –ø—Ä—è–º–æ —Å—é–¥–∞.
# –¢–µ–ø–µ—Ä—å —Ñ—É–Ω–∫—Ü–∏–∏ check_dependencies, gather_system_facts –∏ prompt_persistence –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–∞–∫, –±—É–¥—Ç–æ –æ–Ω–∏ –Ω–∞–ø–∏—Å–∞–Ω—ã –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ.


# === –ë–õ–û–ö 4: –õ–û–í–£–®–ö–ê –î–õ–Ø –ü–†–ï–†–´–í–ê–ù–ò–Ø ===
trap 'echo -e "\n\n–ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º."; exit 130' INT TERM
# ü™§ TRAP (–õ–û–í–£–®–ö–ê):
# –°–º. —Ç–≤–æ–π –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ä–∞–∑–±–æ—Ä. –ï—Å–ª–∏ –ø—Ä–∏–ª–µ—Ç–∞–µ—Ç —Å–∏–≥–Ω–∞–ª INT (Ctrl+C) –∏–ª–∏ TERM (–∫–æ–º–∞–Ω–¥–∞ kill), –º—ã –ø–∏—à–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –≤—ã—Ö–æ–¥–∏–º —Å –∫–æ–¥–æ–º 130.


# === –ë–õ–û–ö 5: –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø (–°–¶–ï–ù–ê–†–ò–ô) ===
main() {
    # 1. –ó–æ–≤–µ–º –æ—Ö—Ä–∞–Ω–Ω–∏–∫–∞ (–∏–∑ utils.sh)
    check_dependencies
    
    # 2. –ó–æ–≤–µ–º —Å—ã—â–∏–∫–∞ (–∏–∑ collector.sh)
    # –°–æ–∑–¥–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é system_report.
    # –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é —Å–±–æ—Ä–∞ –∏ –∑–∞–ø–∏—Ö–∏–≤–∞–µ–º –í–ï–°–¨ —Ç–µ–∫—Å—Ç –æ—Ç—á–µ—Ç–∞ –≤ —ç—Ç—É –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é.
    local system_report
    system_report=$(gather_system_facts)
    
    # 3. –í—ã–≤–æ–¥ –Ω–∞ —ç–∫—Ä–∞–Ω
    # -e –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å \n –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫.
    echo -e "\n=== –°–ò–°–¢–ï–ú–ù–ê–Ø –°–í–û–î–ö–ê ==="
    echo "$system_report"
    echo "======================="
    
    # 4. –ó–æ–≤–µ–º —Å–µ–∫—Ä–µ—Ç–∞—Ä—è (–∏–∑ io.sh)
    # –ü–µ—Ä–µ–¥–∞–µ–º –æ—Ç—á–µ—Ç –∫–∞–∫ –∞—Ä–≥—É–º–µ–Ω—Ç ($1) –≤–Ω—É—Ç—Ä—å —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.
    prompt_persistence "$system_report"
}

# === –ó–ê–ü–£–°–ö ===
# "$@" ‚Äî –ø–µ—Ä–µ–¥–∞–µ—Ç –≤—Å–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∑–∞–ø—É—Å–∫–∞ (–µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏) –≤ —Ñ—É–Ω–∫—Ü–∏—é main.
main "$@"

















